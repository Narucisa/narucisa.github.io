<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quagmire Updater</title>
<link rel="manifest" href="manifest.json">
</head>
<body>
<h2>Enable notifications for Quagmire Update</h2>
<button id="installBtn" hidden>Install App</button>

<script>
async function registerWorker() {
  if (!("serviceWorker" in navigator)) return alert("Service workers not supported.");
  const reg = await navigator.serviceWorker.register("sw.js");
  setTimeout(async () => {
    const perm = await Notification.requestPermission();
    if (perm === "granted") {
      reg.active.postMessage("start");
    } else {
      alert("Notifications not granted.");
    }
  }, 5000);
}
registerWorker();

// Handle install prompt
let deferredPrompt;
const installBtn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.hidden = false;
});

installBtn.addEventListener("click", async () => {
  installBtn.hidden = true;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
});
</script>
</body>
</html>
